{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WefyX</title>

    <!-- CSS file -->
    <link rel="stylesheet" href="{%static 'css/style.css' %}" type="text/css">

    <!-- fontawesome cdn -->
    <script src="https://kit.fontawesome.com/47bfcb75ec.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- favicon -->
    <link rel="shortcut icon" href="{% static 'images/we.png' %}" type="image/x-icon">

    <!-- boxicons cdn -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <style>
        .profile-container {
            position: relative;
            display: inline-block;
        }

        .profile-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid #ccc;
        }

        .dropdown-menu {
            position: absolute;
            top: 50px;
            right: 0;
            width: 220px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 100;
            overflow: hidden;
            font-family: sans-serif;
        }

        .user-info {
            padding: 12px 16px;
            background: #f9f9f9;
            border-bottom: 1px solid #e5e5e5;
        }

        .user-info strong {
            display: block;
            font-size: 14px;
            color: #333;
        }

        .user-info small {
            font-size: 12px;
            color: #777;
        }

        .dropdown-links a {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
        }

        .dropdown-links a i {
            margin-right: 8px;
        }

        .dropdown-links a:hover {
            background-color: #f0f0f0;
        }

        .dropdown-links hr {
            margin: 8px 0;
            border: none;
            border-top: 1px solid #eee;
        }

        .logout {
            color: #d9534f;
        }
    </style>


</head>
<style>
    .user-account {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .profile-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
    }
</style>


<body>
    <main>
        <!-- site Header -->
        <header>
            <div class="navbar">
                <div class="logo">
                    <img src="/static/images/we.png" alt="WefyX logo">
                    <h2>WefyX</h2>
                </div>

                <nav>
                    <a href="{% url 'home' %}"
                        class="{% if request.resolver_match.url_name == 'home' %}active{% endif %}">Home</a>
                    <a href="{% url 'explore' %}"
                        class="{% if request.resolver_match.url_name == 'explore' %}active{% endif %}">Explore</a>
                    <a href="{% url 'bookstore' %}"
                        class="{% if request.resolver_match.url_name == 'bookstore' %}active{% endif %}">Bookstore</a>
                    <a href="{% url 'guides' %}"
                        class="{% if request.resolver_match.url_name == 'guides' %}active{% endif %}">Guides</a>
                </nav>


                <div class="search_bar">
                    <form action="{% url 'search_results' %}" method="get">
                        <input type="text" placeholder="Search posts, authors, categories..." name="search_query"
                            value="{{ search_query|default:'' }}">
                        <button title="Search" type="submit">
                            <i class="fa fa-search icon-search"></i>
                        </button>
                    </form>
                </div>


                <div class="user-account">
                    {% if user.is_authenticated %}
                    <div class="profile-container">
                        {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="Profile Picture" class="profile-icon"
                            id="profile-icon">
                        {% else %}
                        <img src="{% static 'images/user.png' %}" alt="Default Profile Picture" class="profile-icon"
                            id="profile-icon">
                        {% endif %}
                        <div class="dropdown-menu" id="profile-dropdown">
                            <div class="user-info">
                                <strong>{{ user.get_full_name|default:user.username }}</strong>
                                <small>{{ user.email }}</small>
                            </div>
                            <div class="dropdown-links">
                                <a href="{% url 'profile' username=request.user.username %}">
                                    <i class="fas fa-user"></i>Profile
                                </a>

                                <a href="{% url 'settings' %}"><i class="fas fa-cog"></i> Settings</a>
                                <a href="{% url 'help' %}"><i class="fas fa-question-circle"></i> Help</a>
                                <hr>
                                <a href="{% url 'logout' %}" class="logout"><i class="fas fa-sign-out-alt"></i>
                                    Logout</a>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <a href="{% url 'signup' %}" class="btn sign-up" title="Create account">Sign in</a>
                    {% endif %}
                </div>



            </div>

            <!-- for blog category menu -->

            {% block category %}


            {% endblock category %}

        </header>

        {% block content %}
        <!-- content -->
        {% endblock %}

    </main>
</body>
<script src="{% static 'js/script.js' %}" type="text/javascript"></script>
<script>
    const icon = document.getElementById('profile-icon');
    const dropdown = document.getElementById('profile-dropdown');

    document.addEventListener('click', function (e) {
        if (icon.contains(e.target)) {
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        } else if (!dropdown.contains(e.target)) {
            dropdown.style.display = 'none';
        }
    });
</script>



</html>